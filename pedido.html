<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Pedido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8" >
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
      rel="stylesheet"
    >
    <link rel="icon" href="favicon.png" >
    <link rel="stylesheet" type="text/css" href="styles.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Recepción Almacén</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="index.html">FNSKU</a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="#"
              >Pedido <span class="sr-only">(current)</span></a
            >
          </li>
          <li class="nav-item">
            <a class="nav-link" href="pedidos.html">Por Arribar</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container py-5">
      <div class="row">
        <div class="col-lg-8 mx-auto">
          <div class="form-group">
            <input
              type="text"
              class="form-control form-control-lg"
              id="orderNumber"
              placeholder="Ingrese número de pedido y presione Enter"
              onchange="fetchData()"
            >
          </div>
          <div id="loader" class="text-center">
            <div class="spinner-border text-primary" role="status">
              <span class="sr-only"></span>
            </div>
          </div>
          <div id="orderResult" class="my-4">
            <!-- Aquí se mostrarán los resultados -->
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script>
      var urlParams = new URLSearchParams(window.location.search);
      var order = urlParams.get("order");
      if (order) {
        document.getElementById("orderNumber").value = order;
        fetchData();
      }
      function fetchData() {
        var orderNumber = document.getElementById("orderNumber").value;
        var apiEndpoint =
          "https://script.google.com/macros/s/AKfycbwSu9Sz60cT4CM0N-h37A3wi04C2zqMiqyP-5kyc1IqfX4VQh7xrmKlbmhtYkqs2fwBBA/exec?order=" +
          orderNumber;

        document.getElementById("loader").style.display = "block"; // Show the loader
        fetch(apiEndpoint)
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            var orderResult = document.getElementById("orderResult");
            orderResult.innerHTML = ""; // Clear the previous results

            var statusElement = document.createElement("h3");
            statusElement.innerText = "Estado del Pedido: " + data.status;
            orderResult.appendChild(statusElement);

            data.productos.forEach((item) => {
              var titleElement = document.createElement("h2");
              titleElement.innerText = item.title;
              var asinElement = document.createElement("h3");
              asinElement.innerText = item.asin;
              var qtyElement = document.createElement("h4");
              qtyElement.innerText = "Cantidad: " + item.qty;
              var imgElement = document.createElement("img");
              imgElement.src = item.img;

              orderResult.appendChild(document.createElement("br")); // Add space
              orderResult.appendChild(titleElement);
              orderResult.appendChild(asinElement);
              orderResult.appendChild(document.createElement("br")); // Add space
              orderResult.appendChild(qtyElement);
              orderResult.appendChild(imgElement);
            });
            document.getElementById("loader").style.display = "none"; // Hide the loader
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("loader").style.display = "none"; // Hide the loader
          });
      }
    </script>
  </body>
</html>
